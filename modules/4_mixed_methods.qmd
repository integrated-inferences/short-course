---
title: "Causal Questions: Population Level"
subtitle: "Mixed methods"
format: 
   revealjs:
      embed-resources: true
      theme: serif
      slide-level: 3
      slide-number: true
      toc-depth: 2
      show-slide-number: all
      preview-links: auto
      number-sections: true
      link-color: orange
      smaller: true
---

```{r, include = FALSE}
set.seed(1)
library(knitr)
source("assets/setup.R")
knitr::opts_chunk$set(echo = TRUE)
```


## Population-level causal questions

* **Average causal effects for a population**
    * e.g., What is the average effect of $X$ on $Y$

* **Proportion of different effects in a population**
    * What share of cases in the population have positive effects?
    * What share have negative effects?

* **Causal pathways**
    * e.g., How commonly does $X$ affect $Y$ through $M$ (vs. $N$) in the population?
  


## Causal queries on a DAG: population-level average causal effect


```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2),
       y = c(1, 2, 3, 1, 2, 3),
       names = c("X", expression(theta^X), expression(lambda^X), "Y", expression(theta^Y), expression(lambda^Y)),
       arcs = cbind( c(3, 2, 1, 5, 6),
                     c(2, 1, 4, 4, 5)),
       padding = .4, contraction = .15)

```


* What is the average effect of $X$ on $Y$ in the population? 
    * This is a question about the values in $\lambda^Y$


## Causal queries on a DAG: population-level average causal effect

* With binary variables, the average effect is always the difference between
    * The share of cases with a positive effect
    * The share of cases with a negative effect
* $\lambda_{01} - \lambda_{10}$


## Causal queries on a DAG: population-level average causal effect


```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2),
       y = c(1, 2, 3, 1, 2, 3),
       names = c("X", expression(theta^X), expression(lambda^X), "Y", expression(theta^Y), expression(lambda^Y)),
       arcs = cbind( c(3, 2, 1, 5, 6),
                     c(2, 1, 4, 4, 5)),
       padding = .4, contraction = .15)

```

$ATE = \lambda^Y_{01} - \lambda^Y_{10}$

## ATE with a mediator

```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2, 1, 1, 1),
       y = c(1, 2, 3, 1, 2, 3, 1, 2, 3),
       names = c("I", expression(theta^I), expression(lambda^I), "D", expression(theta^D), expression(lambda^D), "M", expression(theta^M), expression(lambda^M)),
       arcs = cbind( c(3, 2, 1, 5, 6, 7, 8, 9),
                     c(2, 1, 7, 4, 5, 4, 7, 8)),
       padding = .4, contraction = .15)

```
We need to

* Combine two ways of generating positive effects 
* Combine two ways of generating negative effects
* Subtract the first from the second


## ATE with a mediator

```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2, 1, 1, 1),
       y = c(1, 2, 3, 1, 2, 3, 1, 2, 3),
       names = c("I", expression(theta^I), expression(lambda^I), "D", expression(theta^D), expression(lambda^D), "M", expression(theta^M), expression(lambda^M)),
       arcs = cbind( c(3, 2, 1, 5, 6, 7, 8, 9),
                     c(2, 1, 7, 4, 5, 4, 7, 8)),
       padding = .4, contraction = .15)

```

* Two ways of generating positive effects: $\lambda^M_{01} \times \lambda^Y_{01}$ + $\lambda^M_{10} \times \lambda^Y_{10}$
* Two ways of generating negative effects: $\lambda^M_{10} \times \lambda^Y_{01}$ + $\lambda^M_{01} \times \lambda^Y_{10}$
* Subtract the first from the second


## Causal queries on a DAG: how often does $X$ have a positive effect on $Y$?


```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2),
       y = c(1, 2, 3, 1, 2, 3),
       names = c("X", expression(theta^X), expression(lambda^X), "Y", expression(theta^Y), expression(lambda^Y)),
       arcs = cbind( c(3, 2, 1, 5, 6),
                     c(2, 1, 4, 4, 5)),
       padding = .4, contraction = .15)

```

* Proportion of cases with positive effect = $\lambda^Y_{01}$


## Causal queries on a DAG: how often does $X$ have a positive effect on $Y$?

```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2, 1, 1, 1),
       y = c(1, 2, 3, 1, 2, 3, 1, 2, 3),
       names = c("I", expression(theta^I), expression(lambda^I), "D", expression(theta^D), expression(lambda^D), "M", expression(theta^M), expression(lambda^M)),
       arcs = cbind( c(3, 2, 1, 5, 6, 7, 8, 9),
                     c(2, 1, 7, 4, 5, 4, 7, 8)),
       padding = .4, contraction = .15)

```


* Proportion of cases with positive effect = $\lambda^M_{01} \times \lambda^Y_{01}$ + $\lambda^M_{10} \times \lambda^Y_{10}$


    
## Causal queries on a DAG: pathway questions


```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2, 1, 1, 1),
       y = c(1, 2, 3, 1, 2, 3, 2, 3, 4),
       names = c("X", expression(theta^X), expression(lambda^X), "Y", expression(theta^Y), expression(lambda^Y), "M", expression(theta^M), expression(lambda^M)),
       arcs = cbind( c(3, 2, 1, 5, 6, 7, 8, 9, 1),
                     c(2, 1, 7, 4, 5, 4, 7, 8, 4)),
       padding = .4, contraction = .15)

```    

* We can also pose the pathway query at population level
    * What is the share of cases for which $X$ has a positive effect on $Y$ through $M$?
* A question about joint $\lambda^M$ and $\lambda^Y$ distributions


## How will we answer questions about populations?

* We need to learn about those $\lambda$'s
    * About the proportions of the population with different kinds of causal effects
* We will have a prior belief about those proportions
* When we see data on lots of cases, we will update those beliefs about proportions
    * From a prior distribution over $\lambda$ to a posterior distribution over $\lambda$






