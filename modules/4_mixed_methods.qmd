---
title: "Causal Questions: Population Level"
subtitle: "Mixed methods"
format: 
   revealjs:
      embed-resources: true
      theme: serif
      slide-level: 3
      slide-number: true
      toc-depth: 2
      show-slide-number: all
      preview-links: auto
      number-sections: true
      link-color: orange
      smaller: true
---

```{r, include = FALSE}
set.seed(1)
library(knitr)
source("assets/setup.R")
knitr::opts_chunk$set(echo = TRUE)
```


## Population-level causal questions

* **Average causal effects for a population**
    * e.g., What is the average effect of $X$ on $Y$

* **Proportion of different effects in a population**
    * What *share* of cases in the population have positive effects?
    * What *share* have negative effects?
    * For what *share* of treated units with positive outcomes was the outcome *due* to the treatment?

* **Causal pathways**
    * e.g., How commonly does $X$ affect $Y$ through $M$ (vs. $N$) in the population?
  


## The population-level ATE

```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2),
       y = c(1, 2, 3, 1, 2, 3),
       names = c("X", expression(theta^X), expression(lambda^X), "Y", expression(theta^Y), expression(lambda^Y)),
       arcs = cbind( c(3, 2, 1, 5, 6),
                     c(2, 1, 4, 4, 5)),
       padding = .4, contraction = .15)

```


* What is the average effect of $X$ on $Y$ in the population? 
    * This is a question about the values in $\lambda^Y$: the *probability* of the different causal types.
    * Previously these were *parameters* of a causal model.
    * Key move: we now imagine that we *do not know $\lambda$ and need to learn about it*


## The population-level ATE

* With binary variables, the average effect is always the difference between
    * The share of cases with a positive effect
    * The share of cases with a negative effect

$$ATE = \lambda_{01} - \lambda_{10}$$



## ATE with a mediator


```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2, 1, 1, 1),
       y = c(1, 2, 3, 1, 2, 3, 1, 2, 3),
       names = c("I", expression(theta^I), expression(lambda^I), "D", expression(theta^D), expression(lambda^D), "M", expression(theta^M), expression(lambda^M)),
       arcs = cbind( c(3, 2, 1, 5, 6, 7, 8, 9),
                     c(2, 1, 7, 4, 5, 4, 7, 8)),
       padding = .4, contraction = .15)

```

Which types define the query depends, again, on the structural model.

For this mediation model we need to:

* Combine two ways of generating positive effects 
* Combine two ways of generating negative effects
* Subtract the first from the second


## ATE with a mediator


```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2, 1, 1, 1),
       y = c(1, 2, 3, 1, 2, 3, 1, 2, 3),
       names = c("I", expression(theta^I), expression(lambda^I), "D", expression(theta^D), expression(lambda^D), "M", expression(theta^M), expression(lambda^M)),
       arcs = cbind( c(3, 2, 1, 5, 6, 7, 8, 9),
                     c(2, 1, 7, 4, 5, 4, 7, 8)),
       padding = .4, contraction = .15)

```


* Two ways of generating positive effects: $\lambda^M_{01} \times \lambda^Y_{01}$ + $\lambda^M_{10} \times \lambda^Y_{10}$
* Two ways of generating negative effects: $\lambda^M_{10} \times \lambda^Y_{01}$ + $\lambda^M_{01} \times \lambda^Y_{10}$
* Subtract the first from the second


## Positive effects 

Query: How *often* does $X$ have a positive effect on $Y$?


```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2),
       y = c(1, 2, 3, 1, 2, 3),
       names = c("X", expression(theta^X), expression(lambda^X), "Y", expression(theta^Y), expression(lambda^Y)),
       arcs = cbind( c(3, 2, 1, 5, 6),
                     c(2, 1, 4, 4, 5)),
       padding = .4, contraction = .15)

```

* Proportion of cases with positive effect = $\lambda^Y_{01}$


## Positive effects 

Query: How *often* does $X$ have a positive effect on $Y$?

```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2, 1, 1, 1),
       y = c(1, 2, 3, 1, 2, 3, 1, 2, 3),
       names = c("I", expression(theta^I), expression(lambda^I), "D", expression(theta^D), expression(lambda^D), "M", expression(theta^M), expression(lambda^M)),
       arcs = cbind( c(3, 2, 1, 5, 6, 7, 8, 9),
                     c(2, 1, 7, 4, 5, 4, 7, 8)),
       padding = .4, contraction = .15)

```


* Proportion of cases with positive effect = $\lambda^M_{01} \times \lambda^Y_{01}$ + $\lambda^M_{10} \times \lambda^Y_{10}$



## Attribution

Query: How often if $Y=1$ due to $X=1$?


```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2),
       y = c(1, 2, 3, 1, 2, 3),
       names = c("X", expression(theta^X), expression(lambda^X), "Y", expression(theta^Y), expression(lambda^Y)),
       arcs = cbind( c(3, 2, 1, 5, 6),
                     c(2, 1, 4, 4, 5)),
       padding = .4, contraction = .15)

```

* Proportion of cases with positive effect among those with $Y=1$, when $X=1$:

$$Attribution = \frac{\lambda^Y_{01}}{\lambda^Y_{01} + \lambda^Y_{11}}$$

    
## Pathway questions


```{r, echo = FALSE, fig.width = 5, fig.height = 3,  fig.align = "center", out.width='.9\\textwidth'}
par(mar=c(1,1,1,1))
hj_dag(x = c(0, 0, 0, 2, 2, 2, 1, 1, 1),
       y = c(1, 2, 3, 1, 2, 3, 2, 3, 4),
       names = c("X", expression(theta^X), expression(lambda^X), "Y", expression(theta^Y), expression(lambda^Y), "M", expression(theta^M), expression(lambda^M)),
       arcs = cbind( c(3, 2, 1, 5, 6, 7, 8, 9, 1),
                     c(2, 1, 7, 4, 5, 4, 7, 8, 4)),
       padding = .4, contraction = .15)

```    

* We can also pose the pathway query at population level
    * What is the share of cases for which $X$ has a positive effect on $Y$ through $M$?
* A question about joint $\lambda^M$ and $\lambda^Y$ distributions






