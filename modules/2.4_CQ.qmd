---
format: 
   revealjs:
      embed-resources: true
      theme: serif
      slide-level: 3
      slide-number: true
      toc-depth: 2
      show-slide-number: all
      preview-links: auto
      number-sections: true
      link-color: orange
      smaller: true
title: "Updating in CausalQueries"
bibliography: assets/bib.bib
---


```{r, include = FALSE}
library(DeclareDesign)
library(CausalQueries)
source("assets/setup.R")

run <- FALSE

```

## Big picture

`CausalQueries` brings these elements together by allowing users to:

1. Make model: Specify a DAG: `CausalQueries` figures out all causal types and places probabilities on these (parameters)
2. Query model: `CausalQueries` figures out which types correspond to a given causal query given case data and figures out the probability of these (*given* some parameters)
3. Update model: `CausalQueries` figures out which parameters are more likely given data, allowing you to query using these parameters 

## Illustration of 1 and 2

When we pose queries *given* different data we are in fact using Bayesian updating.

Below we update on our beliefs *about a single case* given different data we might see. This, essentially, is what process tracing is (in our view).

```{r}
make_model('X -> M -> Y') |>
  set_restrictions(decreasing("X", "M"))|>
  set_restrictions(decreasing("M", "Y"))|>
  query_model(
    query = "Y[X=1] != Y[X=0]",
    given = c("All",
              "X==1 & Y ==1", 
              "M==0", 
              "M==1",
              "X==1 & Y ==1 & M==0",
              "X==1 & Y ==1 & M==1"),
    using = "parameters"
) 

```
## Illustration of 3

We will spend more time on 3 later but in brief:

* `update_model()` lets you update over population *parameters* not just *case types*

```{r, eval = FALSE}
model <- make_model("X->Y") 
data  <- data.frame(X = c(0,0,1,1), Y = c(0,0,1,1))

model <- update_model(model, data) |>
  query_model("Y[X=1] - Y[X=0]", using = "posteriors")
```

```{r, echo = FALSE}
model <- make_model("X->Y") 
data  <- data.frame(X = c(0,0,1,1), Y = c(0,0,1,1))

model <- update_model(model, data, refresh = 0) 

model |>
  query_model("Y[X=1] - Y[X=0]", using = "posteriors")
```
