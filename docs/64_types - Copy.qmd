---
title: "The 64 causal types in a mediation model"
format:
  html:
    embed-resources: true
    toc: false
---

```{=html}
<style>
.type-table {
  margin: 0 auto;
  border-collapse: separate;
  border-spacing: 4px 2px;
}
.type-table td,
.type-table th {
  border: none;
  padding: 4px 6px;
}
.section-pill {
  display: inline-block;
  background: #f2f2f2;
  padding: 4px 10px;
  border-radius: 999px;
  font-weight: 600;
}
.pill {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 999px;
  font-weight: 600;
}
.ym-pill {
  background: #e7f1ff;
}
.x0-pill {
  background: #fff0cc;
}
.x1-pill {
  background: #ffe0e0;
}
.mini-table {
  display: grid;
  gap: 2px;
}
.mini-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}
.mini-val {
  font-weight: 600;
}
</style>
```

```{r, include=FALSE}
library(kableExtra)
library(magrittr)
```

```{r}
#| results: asis
raw <- read.csv("64_types.csv", header = FALSE, stringsAsFactors = FALSE)

row_block <- raw[5:20, ]
y_bits <- row_block[, 2:5]
nums <- row_block[, 7:10]

format_label <- function(text) {
  parts <- strsplit(text, ",\\s*")[[1]]
  parts <- gsub("X=([01])", "X = \\1", parts)
  parts <- gsub("M=([01])", "M = \\1", parts)
  paste(parts, collapse = ", ")
}

y_headers <- vapply(raw[4, 2:5], format_label, character(1))
y_headers <- sprintf("<span class='pill ym-pill'>%s</span>", y_headers)

x0_vals <- as.character(raw[2, 7:10])
x1_vals <- as.character(raw[3, 7:10])

m_header_row1 <- c("<span class='pill x0-pill'>X = 0</span>", x0_vals)
m_header_row2 <- c("<span class='pill x1-pill'>X = 1</span>", x1_vals)

y_bits <- apply(y_bits, c(1, 2), function(x) {
  cell_spec(x, extra_css = "color: #444; padding: 2px 6px;")
})

nums_bold <- apply(nums, c(1, 2), function(x) {
  cell_spec(
    x,
    bold = TRUE,
    extra_css = paste(
      "display: inline-block;",
      "min-width: 2.1em;",
      "text-align: center;",
      "border: 1px solid #d9d9d9;",
      "border-radius: 4px;",
      "padding: 2px 6px;"
    )
  )
})

table_df <- cbind(y_bits, key = rep("", nrow(nums_bold)), nums_bold)
colnames(table_df) <- c(y_headers, rep("", 5))

header_labels <- c(
  "<span class='section-pill'>Y when</span>",
  "<span class='section-pill'>M when</span>"
)
header_spans <- c(4, 5)

knitr::kable(
  table_df,
  escape = FALSE,
  align = "c",
  table.attr = 'class="type-table"',
  row.names = FALSE,
  format = "html"
) %>%
  add_header_above(
    setNames(
      rep(1, 9),
      c(rep("&#160;", 4), m_header_row2)
    ),
    escape = FALSE
  ) %>%
  add_header_above(
    setNames(
      rep(1, 9),
      c(rep("&#160;", 4), m_header_row1)
    ),
    escape = FALSE
  ) %>%
  add_header_above(
    setNames(header_spans, header_labels),
    escape = FALSE
  ) %>%
  kable_styling(full_width = FALSE, position = "center") %>%
  column_spec(5, width = "4em")
```
